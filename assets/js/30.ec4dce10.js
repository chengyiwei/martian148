(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{395:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"安装-make"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-make"}},[s._v("#")]),s._v(" 安装 Make")]),s._v(" "),a("p",[s._v("在 MacOS 的终端中输入")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("brew install make gcc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("会自动安装相关工具")]),s._v(" "),a("p",[s._v("我们可以使用 "),a("code",[s._v("make -v")]),s._v(" 来验证安装是否成功")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("(base) martian148@Mac ~ % make -v\nGNU Make 3.81\nCopyright (C) 2006  Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE.\n\nThis program built for i386-apple-darwin11.3.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"基础操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础操作"}},[s._v("#")]),s._v(" 基础操作")]),s._v(" "),a("p",[s._v("假设我们现在有 3 个文本文件 "),a("code",[s._v("a.txt")]),s._v("，"),a("code",[s._v("b.txt")]),s._v("，"),a("code",[s._v("c.txt")])]),s._v(" "),a("p",[s._v("现在，我们需要合并 "),a("code",[s._v("a.txt")]),s._v(" 和 "),a("code",[s._v("b.txt")]),s._v(" 生成中间文件 "),a("code",[s._v("m.txt")]),s._v("，然后用 "),a("code",[s._v("m.txt")]),s._v(" 和 "),a("code",[s._v("c.txt")]),s._v(" 合并生成 "),a("code",[s._v("x.txt")])]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://pic-1301573324.cos.ap-chengdu.myqcloud.com/image-20250427130943935.png",alt:"image-20250427130943935"}}),s._v(" "),a("p",[s._v("现在我们来编写 makefile")]),s._v(" "),a("h3",{attrs:{id:"规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#规则"}},[s._v("#")]),s._v(" 规则")]),s._v(" "),a("p",[s._v("编写的格式为")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("目标文件: 依赖文件1 依赖文件2\n\t命令\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在这里，我们生成 "),a("code",[s._v("m.txt")]),s._v(" 的命令就是")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("m.txt: a.txt b.txt\n\tcat a.txt b.txt > m.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("同理，我们能得出生成 "),a("code",[s._v("x.txt")]),s._v(" 的命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("x.txt: m.txt c.txt\n\tcat m.txt c.txt > x.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("根据 make 的默认第一条规则，就是认为 "),a("code",[s._v("x.txt")]),s._v(" 为目标文件，所以需要吧 "),a("code",[s._v("x.txt")]),s._v(" 放在前面，然后当运行发现缺少 "),a("code",[s._v("m.txt")]),s._v(" 时，make 会自动去寻找后面有没有命令生成 "),a("code",[s._v("m.txt")])]),s._v(" "),a("p",[s._v("简单来说就是")]),s._v(" "),a("blockquote",[a("p",[s._v("你想要生成什么，那个目标就得放在第一条")])]),s._v(" "),a("h3",{attrs:{id:"伪目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#伪目标"}},[s._v("#")]),s._v(" 伪目标")]),s._v(" "),a("p",[s._v("因为 "),a("code",[s._v("m.txt")]),s._v(" 和 "),a("code",[s._v("x.txt")]),s._v(" 都是自动生成的文件，我们可以使用 "),a("code",[s._v("clean")]),s._v(" 命令来删除他们")]),s._v(" "),a("p",[s._v("我们需要编写 "),a("code",[s._v("clean")]),s._v(" 命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("clean:\n\trm -f m.txt\n\trm -f x.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("执行 "),a("code",[s._v("make clean")]),s._v(" 后，"),a("code",[s._v("m.txt")]),s._v(" 和 "),a("code",[s._v("x.txt")]),s._v(" 都被删除了")]),s._v(" "),a("p",[s._v("但是如果我的目录中存在一个名字为 "),a("code",[s._v("clean")]),s._v(" 的文件，make 会认为 clean 已经存在就不执行 "),a("code",[s._v("make clean")]),s._v(" 的命令")]),s._v(" "),a("p",[s._v("这里就需要一个 "),a("code",[s._v(".PHONY: clean")]),s._v(" 命令告诉 make：“clean”是一个伪目标，不是一个实际存在的文件，无论有没有叫 "),a("code",[s._v("clean")]),s._v("  的文件，都需要执行 "),a("code",[s._v("make clean")]),s._v(" 命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(".PHONY: clean\nclean:\n\trm -f m.txt\n\trm -f x.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"使用-makefile-编译-c-程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-makefile-编译-c-程序"}},[s._v("#")]),s._v(" 使用 makefile 编译 C 程序")]),s._v(" "),a("p",[s._v("假设有一个 C 项目，包含 "),a("code",[s._v("hello.c")]),s._v("、"),a("code",[s._v("hello.h")]),s._v(" 和 "),a("code",[s._v("main.c")])]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// hello.c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello, world!\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// hello.h")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// main.c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello.h"')])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start...\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exit.\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("我们很容易得出逻辑图")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://pic-1301573324.cos.ap-chengdu.myqcloud.com/image-20250427133052077.png",alt:"image-20250427133052077"}}),s._v(" "),a("p",[s._v("我们很容易就能写出 Makefile")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成可执行文件:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("world.out")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello.o main.o\n\tcc -o world.out hello.o main.o\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译 hello.c:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("hello.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello.c\n\tcc -c hello.c\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译 main.c:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("main.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main.c hello.h\n\tcc -c main.c\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -f *.o world.out\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("执行 "),a("code",[s._v("make")]),s._v(" 可以看到")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" hello.c\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" main.c\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" world.out hello.o main.o\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("运行 "),a("code",[s._v("world.out")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ./world.out \nstart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nhello, world"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nexit.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("如果我们修改 "),a("code",[s._v("hello.c")]),s._v(" 中的内容为")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello, bob!\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("再次 "),a("code",[s._v("make")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" hello.c\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" world.out hello.o main.o\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("会发现，没有再次编译 "),a("code",[s._v("main.o")]),s._v(" 因为 "),a("code",[s._v("main.o")]),s._v(" 的没有改变")]),s._v(" "),a("h2",{attrs:{id:"使用隐式规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用隐式规则"}},[s._v("#")]),s._v(" 使用隐式规则")]),s._v(" "),a("p",[s._v("其实在前面那个例子里面，我们把生成 "),a("code",[s._v(".o")]),s._v(" 的规则都删掉，程序也能正常编译")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成可执行文件:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("world.out")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello.o main.o\n\tcc -o world.out hello.o main.o\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -f *.o world.out\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\ncc    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" hello.o hello.c\ncc    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" main.o main.c\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" world.out hello.o main.o\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("其实是 make 内部自定义了一些规则，对于 "),a("code",[s._v(".o")]),s._v(" 内置了")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("xyz.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" xyz.c\n\tcc -c -o xyz.o xyz.c\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("就不用我们手写了")]),s._v(" "),a("h2",{attrs:{id:"使用变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用变量"}},[s._v("#")]),s._v(" 使用变量")]),s._v(" "),a("p",[s._v("我们在编写 "),a("code",[s._v("makefile")]),s._v(" 的时候会重复写很多文件名，一来容易写错，二来如果要改名就要重新写一次")]),s._v(" "),a("p",[s._v("我们可以使用变量来解决反复引用的问题")]),s._v(" "),a("p",[s._v("看到我们之前的 makefile")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("world.out")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello.o main.o\n\tcc -o world.out hello.o main.o\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -f *.o world.out\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("其中 "),a("code",[s._v("world.out")]),s._v(" 出现了三次，我们可以定义一个变量来替换他")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[s._v("TARGET "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" world.out\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),s._v("(TARGET)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello.o main.o\n\tcc -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" hello.o main.o\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -f *.o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("变量定义用"),a("code",[s._v("变量名 = 值")]),s._v("或者"),a("code",[s._v("变量名 := 值")]),s._v("，通常变量名全大写。引用变量用"),a("code",[s._v("$(变量名)")])]),s._v(" "),a("p",[s._v("注意到"),a("code",[s._v("hello.o main.o")]),s._v("这个“列表”也重复了，我们也可以用变量来替换：")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[s._v("OBJS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hello.o main.o\nTARGET "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" world.out\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),s._v("(TARGET)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tcc -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -f *.o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("如果我们能用一种方法能自动识别当前目录下的所有 "),a("code",[s._v(".c")]),s._v(" 文件，然后对应到 "),a("code",[s._v(".o")]),s._v(" 最后赋值给 "),a("code",[s._v("OBJS")]),s._v(" 就好了，实际上我们可以通过函数来做到这一点")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $(wildcard *.c) 列出当前目录下的所有 .c 文件: hello.c main.c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用函数 patsubst 进行模式替换得到: hello.o main.o")]),s._v("\nOBJS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("patsubst")]),s._v(" %.c,%.o,"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wildcard")]),s._v(" *.c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTARGET "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" world.out\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),s._v("(TARGET)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tcc -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -f *.o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"内置变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内置变量"}},[s._v("#")]),s._v(" 内置变量")]),s._v(" "),a("p",[s._v("我们可以使用 "),a("code",[s._v("$(CC)")]),s._v(" 代替命令 "),a("code",[s._v("cc")])]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token target symbol"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),s._v("(TARGET)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("系统内部默认了 "),a("code",[s._v("$(CC)=cc")]),s._v("，但是我们也可以自定义他 "),a("code",[s._v("$(CC)=gcc")])]),s._v(" "),a("h3",{attrs:{id:"自动变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动变量"}},[s._v("#")]),s._v(" 自动变量")]),s._v(" "),a("p",[s._v("我们也可以用一些特殊意义的字符来代表一些含义，这些字符叫做自动变量")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("$@")]),s._v(" 表示目标文件")]),s._v(" "),a("li",[a("code",[s._v("$^")]),s._v(" 表示所有依赖文件")]),s._v(" "),a("li",[a("code",[s._v("$<")]),s._v(" 表示第一个依赖文件")]),s._v(" "),a("li",[a("code",[s._v("$?")]),s._v(" 所有比目标新的依赖文件")]),s._v(" "),a("li",[a("code",[s._v("$*")]),s._v(" 目标文件去掉拓展名，例如 "),a("code",[s._v("foo.o")]),s._v(" 的 "),a("code",[s._v("$*")]),s._v(" 是 "),a("code",[s._v("foo")])])]),s._v(" "),a("p",[s._v("前面的命令可以转化成为")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("world.out")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello.o main.o\n\tcc -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("为了更好的调试，我们可以把变量打印出来")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("world.out")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello.o main.o\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$$@ = $@'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变量 $@ 表示target")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$$< = $<'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变量 $< 表示第一个依赖项")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$$^ = $^'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变量 $^ 表示所有依赖项")]),s._v("\n\tcc -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("gcc    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" hello.o hello.c\ngcc    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" main.o main.c\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" world.out\n$"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hello.o\n$^ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hello.o main.o\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" world.out hello.o main.o\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"使用规则模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用规则模式"}},[s._v("#")]),s._v(" 使用规则模式")]),s._v(" "),a("p",[s._v("当我们没有创建 "),a("code",[s._v(".o")]),s._v(" 的生成规则的时候，makefile 会自动生成一条规则，对于 "),a("code",[s._v("xyz.o xyz.c")]),s._v(" 他的规则如下")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CFLAGS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -c -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$<")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这里的变量 "),a("code",[s._v("$(CC)")]),s._v(" 和 "),a("code",[s._v("$(CFLAGS)")]),s._v(" 可以自己设定")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("$(CFLAGS)")]),s._v(" 是附加的编译指令")])]),s._v(" "),a("p",[s._v("我们如果要自定义这个规则也是可以的")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模式匹配规则：当make需要目标 xyz.o 时，自动生成一条 xyz.o: xyz.c 规则:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("%.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" %.c\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'compiling $<...'")]),s._v("\n\tcc -c -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$<")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("通过这个指令，我告诉了计算机，如果出现了一个 "),a("code",[s._v(".o")]),s._v(" 就需要自动匹配一个 "),a("code",[s._v(".c")])]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[s._v("OBJS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("patsubst")]),s._v(" %.c,%.o,"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wildcard")]),s._v(" *.c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTARGET "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" world.out\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),s._v("(TARGET)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("%.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" %.c\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -c -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$<")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -f *.o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("运行 make")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" hello.o hello.c\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" main.o main.c\ncc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" world.out hello.o main.o\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("模式规则的命令完全由我们自己定义，因此，它比隐式规则更灵活。")]),s._v(" "),a("p",[s._v("但是，模式规则仍然没有解决修改"),a("code",[s._v("hello.h")]),s._v("头文件不会触发"),a("code",[s._v("main.c")]),s._v("重新编译的问题")]),s._v(" "),a("h2",{attrs:{id:"自动生成依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动生成依赖"}},[s._v("#")]),s._v(" 自动生成依赖")]),s._v(" "),a("p",[s._v("前面我们讲了隐式规则和模式规则，这两种规则都可以解决自动把"),a("code",[s._v(".c")]),s._v("文件编译成"),a("code",[s._v(".o")]),s._v("文件，但都无法解决"),a("code",[s._v(".c")]),s._v("文件依赖"),a("code",[s._v(".h")]),s._v("文件的问题。")]),s._v(" "),a("p",[s._v("因为一个"),a("code",[s._v(".c")]),s._v("文件依赖哪个"),a("code",[s._v(".h")]),s._v("文件必须要分析文件内容才能确定，没有一个简单的文件名映射规则。")]),s._v(" "),a("p",[s._v("但是，要识别出"),a("code",[s._v(".c")]),s._v("文件的头文件依赖，可以用GCC提供的"),a("code",[s._v("-MM")]),s._v("参数")]),s._v(" "),a("p",[s._v("在终端中运行")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[s._v("$ cc -MM main.c\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("main.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main.c hello.h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("一个简单的想法就是把对一个 "),a("code",[s._v(".c")]),s._v(" 文件都生成一个依赖项，把它保存到 "),a("code",[s._v(".d")]),s._v(" 中，然后再用 "),a("code",[s._v("include")]),s._v(" 引入到 Makefile 相当于自动化匹配了 "),a("code",[s._v(".c")]),s._v(" 的文件依赖")]),s._v(" "),a("p",[s._v("我们修改 "),a("code",[s._v("Makefile")]),s._v(" 文件")]),s._v(" "),a("div",{staticClass:"language-makefile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-makefile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有 .c 文件:")]),s._v("\nSRCS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wildcard")]),s._v(" *.c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据SRCS生成 .o 文件列表:")]),s._v("\nOBJS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SRCS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(".c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据SRCS生成 .d 文件列表:")]),s._v("\nDEPS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SRCS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(".c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nTARGET "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" world.out\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认目标:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),s._v("(TARGET)")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OBJS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$^")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# xyz.d 的规则由 xyz.c 生成:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("%.d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" %.c\n\trm -f "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@;")]),s._v(" \\\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -MM "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$<")]),s._v(" >"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@.tmp;")]),s._v(" \\\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里")]),s._v("\n\tsed "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s,\\($*\\)\\.o[ :]*,\\1.o $@ : ,g'")]),s._v(" < "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@.tmp")]),s._v(" > "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@;")]),s._v(" \\ \n\trm -f "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@.tmp")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模式规则:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("%.o")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" %.c\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -c -o "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$<")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("clean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\trm -rf *.o *.d "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TARGET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 引入所有 .d 文件:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DEPS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin-target builtin"}},[s._v(".PHONY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" echo\n"),a("span",{pre:!0,attrs:{class:"token target symbol"}},[s._v("echo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SRCS: $(SRCS)"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OBJS: $(OBJS)"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DEPS: $(DEPS)"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TARGET: $(TARGET)"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("ul",[a("li",[s._v("我们先定义了 "),a("code",[s._v("SRCS")]),s._v(" "),a("code",[s._v("OBJS")]),s._v(" "),a("code",[s._v("DEPS")]),s._v("，通过 "),a("code",[s._v("echo")]),s._v(" 命令可以看到这些变量的值")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("\nSRCS: hello.c main.c\nOBJS: hello.o main.o\nDEPS: hello.d main.d\nTARGET: world.out\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("然后我们定义了 "),a("code",[s._v(".d")]),s._v(" 的生成规则")]),s._v(" "),a("ul",[a("li",[s._v("先删除 "),a("code",[s._v(".d")])]),s._v(" "),a("li",[s._v("通过 "),a("code",[s._v("-MM")]),s._v(" 命令获得依赖，例如 ："),a("code",[s._v("main.o: main.c hello.h")])]),s._v(" "),a("li",[s._v("然后 "),a("code",[s._v("'s,\\($*\\)\\.o[ :]*,\\1.o $@ : ,g' < $@.tmp >")]),s._v(" 命令通过函数把 "),a("code",[s._v("main.o : main.c hello.h")]),s._v(" 转化成 "),a("code",[s._v("main.o main.d : main.c hello.h")]),s._v(" 表面了 "),a("code",[s._v("main.o main.d")]),s._v(" 都依赖于 "),a("code",[s._v("main.c hello.h")])]),s._v(" "),a("li",[s._v("最后删除 "),a("code",[s._v("tmp")]),s._v(" 文件")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("include $(DEPS)")]),s._v(" 的意思就是")]),s._v(" "),a("ul",[a("li",[s._v("把 "),a("code",[s._v("$(DEPS)")]),s._v(" 里面列出的所有文件，当成 Makefile 的一部分，读进来。")]),s._v(" "),a("li",[s._v("就相当于在 makefile 里面写入了 "),a("code",[s._v("main.o main.d : main.c hello.h")]),s._v(" 和 "),a("code",[s._v("hello.o hello.d : hello.c")])])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);